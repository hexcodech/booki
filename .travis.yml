sudo: required
services:
  - docker
language: node_js
node_js:
  - "node"
notifications:
  email: false
  webhooks:
    - http://server.tyratox.ch/webhooks/travis/booki.php
env:
  - DOCKER_USERNAME=tyratox
  - secure: "xoCy2UG8eSMcRIcMHc8Cn9cGeKcFCfjRbrb4a7ju7Ce4pMQg8Wp8RkzxB/N8qCKh+k/HmyeQoAU9sf9HgbQvierKiS5kg0xmOkujJ7/vl7Go1B+YkJniKuYJ95ElPm1Sp/7YN8Xu9TObVayfCJMoZpDEeW0zYm7fb/PYQV4xP1oMk3nLIq0T/G1rPS96jiFAKMF42zOpTKJXtAgJaCkCIAUhB+quVcn8dFQFPZqIFkFqzwEyZlVqzjna7Qac14dObxRM9U0TQmIzRw5ImisiSwtjMBrIBDnXrN5BUhh9uaMCdEvij+b2EMAM5J5iG8XY0ggV9DgQxs3tOHckJXbaKpTBKB6PsFGpob5wr8v0ubm0CpEapgcS2ujr62GPhQZCiB4SoVIQAepvHwDJYUY0LgNAPklPh3sPpHcuLM/d6Z0D65447F9Zb9aYIxYMD2R4t4Dqe3z55VgtIB8Dk7uMURjTPV/LeyJyFtviTjEkGwhshyI98AJ87dQrE9SP9ikTVbJ76UISyf0KelAnbqPX0fkK3zgFj5dMzqApQF0snbbjJWtP4eid65N2eH2nkeBx5SnnFunkdHdpUySLXQ7kbWJB/D42a444vzezNXSw72adoKhqe2dJ6rqIgc1Oalftkw+/l2LeXc3GMQgK+LsECcgKMU6+B8B8aPfqi9PLkuU="
install: yarn install
before_script: yarn test
script:
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "release" ]; then
    docker build -t tyratox/booki:release .
    fi
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "master" ]; then
    docker build -t tyratox/booki:staging .
    fi
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "dev" ]; then
    docker build -t tyratox/booki:testing .
    fi
after_success:
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "release" ]; then
    docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker push tyratox/booki:latest;
    fi
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "master" ]; then
    docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker push tyratox/booki:staging;
    fi
  - if [ "$TRAVIS_PULL_REQUEST" = "false" ] && [ "$TRAVIS_BRANCH" == "dev" ]; then
    docker login -u="$DOCKER_USERNAME" -p="$DOCKER_PASSWORD";
    docker push tyratox/booki:testing;
    fi
